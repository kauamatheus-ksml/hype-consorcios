<?php
/**
 * Script para criar tabela de configura√ß√µes do site
 * Hype Cons√≥rcios
 */

require_once 'config/database.php';

// Conectar ao banco
$database = new Database();
$conn = $database->getConnection();

if (!$conn) {
    die("Erro na conex√£o com o banco de dados.");
}

try {
    // Criar tabela de configura√ß√µes do site
    $sql = "
    CREATE TABLE IF NOT EXISTS site_config (
        id INT AUTO_INCREMENT PRIMARY KEY,
        config_key VARCHAR(100) NOT NULL UNIQUE,
        config_value TEXT,
        config_type ENUM('text', 'textarea', 'image', 'number', 'boolean') DEFAULT 'text',
        section VARCHAR(50) NOT NULL,
        display_name VARCHAR(200) NOT NULL,
        description TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

        INDEX idx_section (section),
        INDEX idx_config_key (config_key)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
    ";

    $conn->exec($sql);
    echo "‚úÖ Tabela 'site_config' criada com sucesso!\n\n";

    // Inserir configura√ß√µes padr√£o baseadas no index.php atual
    $defaultConfigs = [
        // Hero Section
        ['hero_title_main', 'Voc√™ tem sonhos', 'text', 'hero', 'T√≠tulo Principal do Hero', 'Primeira parte do t√≠tulo principal da p√°gina'],
        ['hero_title_highlight', 'n√≥s temos a chave', 'text', 'hero', 'T√≠tulo Destacado do Hero', 'Segunda parte do t√≠tulo (com gradiente)'],
        ['hero_subtitle', 'Com parcelas que voc√™ nunca imaginou. Seu carro novo h√° clique de voc√™.', 'textarea', 'hero', 'Subt√≠tulo do Hero', 'Texto descritivo abaixo do t√≠tulo'],
        ['hero_video', 'assets/videos/test-drive-hero.mp4', 'image', 'hero', 'V√≠deo de Fundo', 'Upload do v√≠deo de fundo'],
        ['hero_logo', 'assets/images/logo.png', 'image', 'hero', 'Logo no Hero', 'Logo flutuante no hero'],

        // Meta Tags
        ['site_title', 'Hype Cons√≥rcios - Voc√™ tem sonhos n√≥s temos a chave', 'text', 'meta', 'T√≠tulo do Site', 'T√≠tulo principal da p√°gina (meta title)'],
        ['site_description', 'Realize o sonho do carro novo com o Cons√≥rcio Volkswagen. Parceiro autorizado com as melhores condi√ß√µes. Simule agora!', 'textarea', 'meta', 'Descri√ß√£o do Site', 'Descri√ß√£o meta para SEO'],
        ['site_keywords', 'cons√≥rcio de ve√≠culos, cons√≥rcio volkswagen, cons√≥rcio carros, cons√≥rcio sem juros, embracon, carta contemplada, cons√≥rcio leves premium pesados', 'textarea', 'meta', 'Palavras-chave', 'Keywords para SEO'],
        ['og_image', 'https://hypeconsorcios.com.br/assets/images/consorcio-jaragua-do-sul-og.jpg', 'text', 'meta', 'Imagem Open Graph', 'Imagem para compartilhamento em redes sociais'],

        // Company Info
        ['company_name', 'Hype Cons√≥rcios E Investimentos Ltda', 'text', 'company', 'Nome da Empresa', 'Raz√£o social da empresa'],
        ['company_phone', '(47) 99686-2997', 'text', 'company', 'Telefone', 'Telefone principal da empresa'],
        ['company_whatsapp', '5547996862997', 'text', 'company', 'WhatsApp', 'N√∫mero do WhatsApp (formato internacional)'],
        ['company_instagram', 'hype.consorcios', 'text', 'company', 'Instagram', 'Usuario do Instagram'],
        ['company_address', 'Rua Jos√© Narloch, 1953', 'text', 'company', 'Endere√ßo', 'Endere√ßo da empresa'],
        ['company_neighborhood', 'Bairro Tifa Martins', 'text', 'company', 'Bairro', 'Bairro da empresa'],
        ['company_city', 'Jaragu√° do Sul', 'text', 'company', 'Cidade', 'Cidade da empresa'],
        ['company_state', 'SC', 'text', 'company', 'Estado', 'Estado da empresa'],
        ['company_cnpj', '53.170.406/0001-89', 'text', 'company', 'CNPJ', 'CNPJ da empresa'],

        // About Section
        ['about_title', 'Por que escolher a', 'text', 'about', 'T√≠tulo da Se√ß√£o Sobre', 'Primeira parte do t√≠tulo da se√ß√£o'],
        ['about_title_highlight', 'Hype Cons√≥rcios?', 'text', 'about', 'T√≠tulo Destacado Sobre', 'Segunda parte do t√≠tulo (com gradiente)'],
        ['about_subtitle', 'Na Hype Cons√≥rcios, oferecemos uma assessoria exclusiva em todo o processo de contempla√ß√£o ‚Äî desde a assinatura do contrato at√© a entrega do seu ve√≠culo.', 'textarea', 'about', 'Subt√≠tulo Sobre', 'Primeiro par√°grafo da se√ß√£o sobre'],
        ['about_text1', 'Somos representantes de uma marca consolidada nacionalmente: o Cons√≥rcio Volkswagen, administrado pela Embracon, especialista em cons√≥rcios e respons√°vel pela entrega de mais de 700 mil bens desde 1960.', 'textarea', 'about', 'Texto Sobre 1', 'Segundo par√°grafo'],
        ['about_text2', 'Nosso diferencial est√° no atendimento √°gil, transparente e personalizado, sempre focado nas necessidades de cada cliente. Afinal, nosso prop√≥sito vai muito al√©m de comercializar cons√≥rcios: queremos realizar o seu sonho.', 'textarea', 'about', 'Texto Sobre 2', 'Terceiro par√°grafo'],

        // Cars Section
        ['cars_title', 'Descubra nossa', 'text', 'cars', 'T√≠tulo da Se√ß√£o Ve√≠culos', 'Primeira parte do t√≠tulo'],
        ['cars_title_highlight', 'linha completa de cr√©dito veicular', 'text', 'cars', 'T√≠tulo Destacado Ve√≠culos', 'Segunda parte do t√≠tulo (com gradiente)'],

        // Ve√≠culos Leves
        ['leves_price', 'Parcelas a partir de 811,25', 'text', 'cars', 'Pre√ßo Ve√≠culos Leves', 'Pre√ßo dos ve√≠culos leves'],
        ['leves_description', 'Realize o sonho do seu carro novo ou seminovo (at√© 10 anos de uso), da marca e modelo que voc√™ escolher. Aqui, seu plano cabe no bolso e seu sonho sai do papel!', 'textarea', 'cars', 'Descri√ß√£o Ve√≠culos Leves', 'Descri√ß√£o dos ve√≠culos leves'],
        ['leves_image', 'assets/images/polo-blue.jpg', 'image', 'cars', 'Imagem Ve√≠culos Leves', 'Imagem dos ve√≠culos leves'],

        // Ve√≠culos Premium
        ['premium_price', 'Parcelas a partir de 1.480,00', 'text', 'cars', 'Pre√ßo Ve√≠culos Premium', 'Pre√ßo dos ve√≠culos premium'],
        ['premium_description', 'Adquira seu carro premium de forma inteligente, sem comprometer seu patrim√¥nio. O ve√≠culo dos seus sonhos est√° mais pr√≥ximo do que voc√™ imagina!', 'textarea', 'cars', 'Descri√ß√£o Ve√≠culos Premium', 'Descri√ß√£o dos ve√≠culos premium'],
        ['premium_image', 'assets/images/mercedes.jpg', 'image', 'cars', 'Imagem Ve√≠culos Premium', 'Imagem dos ve√≠culos premium'],

        // Ve√≠culos Pesados
        ['pesados_price', 'Parcelas a partir de 2.530,00', 'text', 'cars', 'Pre√ßo Ve√≠culos Pesados', 'Pre√ßo dos ve√≠culos pesados'],
        ['pesados_description', 'Invista no crescimento do seu neg√≥cio com a aquisi√ß√£o de caminh√µes e carretas novos ou seminovos. Com a carta de cr√©dito para pesados, sua frota ganha mais for√ßa para acelerar resultados.', 'textarea', 'cars', 'Descri√ß√£o Ve√≠culos Pesados', 'Descri√ß√£o dos ve√≠culos pesados'],
        ['pesados_image', 'assets/images/caminhao.jpg', 'image', 'cars', 'Imagem Ve√≠culos Pesados', 'Imagem dos ve√≠culos pesados'],

        // FAQ
        ['faq_title', 'D√∫vidas Frequentes', 'text', 'faq', 'T√≠tulo FAQ', 'T√≠tulo da se√ß√£o de FAQ'],
        ['faq_subtitle', 'Esclarecemos as principais d√∫vidas sobre cons√≥rcio', 'text', 'faq', 'Subt√≠tulo FAQ', 'Subt√≠tulo da se√ß√£o de FAQ'],

        // Location
        ['location_title', 'Nossa', 'text', 'location', 'T√≠tulo Localiza√ß√£o', 'Primeira parte do t√≠tulo'],
        ['location_title_highlight', 'Localiza√ß√£o', 'text', 'location', 'T√≠tulo Destacado Localiza√ß√£o', 'Segunda parte do t√≠tulo (com gradiente)'],
        ['location_subtitle', 'Visite nossa sede em Jaragu√° do Sul e conhe√ßa nossos especialistas pessoalmente! üìç', 'text', 'location', 'Subt√≠tulo Localiza√ß√£o', 'Subt√≠tulo da se√ß√£o'],

        // Clients
        ['clients_title', 'Clientes', 'text', 'clients', 'T√≠tulo Clientes', 'Primeira parte do t√≠tulo'],
        ['clients_title_highlight', 'Contemplados', 'text', 'clients', 'T√≠tulo Destacado Clientes', 'Segunda parte do t√≠tulo (com gradiente)'],
        ['clients_subtitle', 'Veja alguns dos nossos clientes que realizaram o sonho do carro novo! üöó‚ú®', 'text', 'clients', 'Subt√≠tulo Clientes', 'Subt√≠tulo da se√ß√£o'],

        // Career
        ['career_title', 'Trabalhe com a', 'text', 'career', 'T√≠tulo Carreira', 'Primeira parte do t√≠tulo'],
        ['career_title_highlight', 'Hype Cons√≥rcios', 'text', 'career', 'T√≠tulo Destacado Carreira', 'Segunda parte do t√≠tulo (com gradiente)'],
        ['career_subtitle', 'A Hype Cons√≥rcios est√° em constante crescimento e buscamos profissionais que queiram crescer junto com a gente! üöÄ', 'text', 'career', 'Subt√≠tulo Carreira', 'Subt√≠tulo da se√ß√£o'],
        ['career_image', 'assets/images/contarte.png', 'image', 'career', 'Imagem Carreira', 'Imagem da se√ß√£o de trabalhe conosco'],
    ];

    // Preparar statement para inser√ß√£o
    $stmt = $conn->prepare("
        INSERT IGNORE INTO site_config
        (config_key, config_value, config_type, section, display_name, description)
        VALUES (?, ?, ?, ?, ?, ?)
    ");

    $insertedCount = 0;
    foreach ($defaultConfigs as $config) {
        $stmt->execute($config);
        if ($stmt->rowCount() > 0) {
            $insertedCount++;
        }
    }

    echo "‚úÖ $insertedCount configura√ß√µes padr√£o inseridas!\n\n";

    // Mostrar resumo
    $countStmt = $conn->query("SELECT COUNT(*) as total FROM site_config");
    $totalConfigs = $countStmt->fetch()['total'];

    echo "üìä Total de configura√ß√µes na tabela: $totalConfigs\n\n";

    // Mostrar configura√ß√µes por se√ß√£o
    $sectionsStmt = $conn->query("
        SELECT section, COUNT(*) as count
        FROM site_config
        GROUP BY section
        ORDER BY section
    ");

    echo "üìã Configura√ß√µes por se√ß√£o:\n";
    while ($row = $sectionsStmt->fetch()) {
        echo "   ‚Ä¢ {$row['section']}: {$row['count']} configura√ß√µes\n";
    }

    echo "\n‚úÖ Instala√ß√£o conclu√≠da com sucesso!\n";
    echo "üëâ Acesse o painel de administra√ß√£o para editar as configura√ß√µes.\n";

} catch (PDOException $e) {
    echo "‚ùå Erro ao criar tabela: " . $e->getMessage() . "\n";
}

$database->closeConnection();
?>